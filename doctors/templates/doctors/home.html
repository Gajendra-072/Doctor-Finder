{% extends 'doctors/base.html' %}

{% block hero %}
<section class="hero-section" id="hero-section">
    <div class="container hero-content">
        <div class="row justify-content-center">
            <div class="col-md-10 text-center">
                <h1 class="display-4 fw-bold mb-4">Discover specialists for specific organs.</h1>
                
                <div class="search-container">
                    <form action="{% url 'doctors:search_doctors' %}" method="get" class="d-flex">
                        <input type="text" class="form-control me-2" placeholder="Search for organ" name="query">
                        <button type="submit" class="btn search-btn px-4">Search</button>
                    </form>
                    <p class="text-white mt-2">Find doctors for organ related diseases.</p>
                </div>
            </div>
        </div>
    </div>    
    <div id="photo-credit" class="position-absolute bottom-0 end-0 p-2 text-white small" style="background-color: rgba(0,0,0,0.5); border-radius: 5px 0 0 0;">
        Photo by <a href="#" id="photographer-link" target="_blank" class="text-white">Photographer</a> on Unsplash
    </div>

</section>
{% endblock %}

{% block content %}
<div class="row row-cols-2 row-cols-md-4 g-4 mt-4">
    {% for specialty in specialties %}
    <div class="col">
        <a href="{% url 'doctors:search_doctors' %}?query={{ specialty.name }}" class="specialty-card">
            <i class="fas {{ specialty.icon }}"></i>
            <h5>{{ specialty.name }}</h5>
        </a>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            <p class="text-center mb-0">No specializations found.</p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- The existing specializations section is now hidden or commented out -->
{% comment %}
<h2 class="text-center mb-4 mt-5">Browse Doctors by Specialization</h2>

<div class="row row-cols-1 row-cols-md-3 g-4">
    {% for organ in organs %}
    <div class="col">
        <div class="card h-100 organ-card">
            {% if organ.image %}
            <img src="{{ organ.image.url }}" class="card-img-top" alt="{{ organ.name }}">
            {% else %}
            <div class="bg-light text-center py-5">
                <i class="fas fa-heartbeat fa-3x text-primary"></i>
            </div>
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ organ.name }}</h5>
                {% if organ.description %}
                <p class="card-text">{{ organ.description|truncatewords:20 }}</p>
                {% endif %}
                <a href="{% url 'doctors:doctor_list' organ.id %}" class="btn btn-primary">Find Specialists</a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            <p class="text-center mb-0">No specializations found. Please add some through the admin interface.</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endcomment %}
{% endblock %}

{% block extra_js %}
<script>
    // Array to store background images from Unsplash
    let backgroundImages = [];
    let currentImageIndex = 0;
    const heroSection = document.getElementById('hero-section');
    const photoCredit = document.getElementById('photo-credit');
    const photographerLink = document.getElementById('photographer-link');
    
    // Unsplash API configuration
    const unsplashAccessKey = "3sj3wCRyB_QcUdRHGzEsI-j7lx0isYxX9qFSlPw2QSQ";
    const searchTerms = ["medical organs", "human anatomy", "heart brain", "medical science", "human body"];
    
    // Function to fetch images from Unsplash
    async function fetchUnsplashImages() {
        try {
            // Select a random search term
            const randomSearchTerm = searchTerms[Math.floor(Math.random() * searchTerms.length)];
            
            // Fetch images from Unsplash
            const response = await fetch(`https://api.unsplash.com/search/photos?query=${randomSearchTerm}&orientation=landscape&per_page=10`, {
                headers: {
                    'Authorization': `Client-ID ${unsplashAccessKey}`
                }
            });
            
            const data = await response.json();
            
            // Extract image URLs
            if (data.results && data.results.length > 0) {
                backgroundImages = data.results.map(photo => ({
                    url: photo.urls.regular,
                    credit: {
                        name: photo.user.name,
                        link: photo.user.links.html
                    }
                }));
                
                // Start the image rotation
                rotateBackgroundImage();
            }
        } catch (error) {
            console.error('Error fetching images from Unsplash:', error);
            // Use a fallback image if API fails
            heroSection.style.backgroundImage = "url('https://img.freepik.com/premium-photo/heart-brain-stomach-human-internal-organs-anatomy-3d-rendering_62754-29.jpg')";
            photoCredit.style.display = 'none'; // Hide credit if using fallback
        }
    }
    
    // Function to rotate background images
    function rotateBackgroundImage() {
        if (backgroundImages.length === 0) return;
        
        // Get the current image
        const currentImage = backgroundImages[currentImageIndex];
        
        // Set background image
        heroSection.style.backgroundImage = `url('${currentImage.url}')`;
        
        // Update photo credit
        photographerLink.textContent = currentImage.credit.name;
        photographerLink.href = currentImage.credit.link;
        photoCredit.style.display = 'block';
        
        // Increment index for next image
        currentImageIndex = (currentImageIndex + 1) % backgroundImages.length;
        
        // Schedule next rotation
        setTimeout(rotateBackgroundImage, 10000); // 10 seconds
    }
    
    // Start fetching images when page loads
    document.addEventListener('DOMContentLoaded', fetchUnsplashImages);
</script>
{% endblock %} 